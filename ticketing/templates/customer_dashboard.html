{% extends 'dashboard.html' %}

{% block navbar %}
    {% include 'customer_navbar.html' %}
{% endblock %}

{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="row">
    <div class="col-md-8">
        <h2>Welcome, {{ user.name }}</h2>
    <!-- Sidebar for agents list -->
    <div class="col-md-4">

        <h4>Agents You Created</h4>
        <ul id="agentsList" class="list-group">
            {% for agent in agents %}
                <li class="list-group-item">{{ agent.name }} ({{ agent.email }}) - {{ agent.job_title }}</li>
            {% empty %}
                <li class="list-group-item">No agents created yet.</li>
            {% endfor %}
        </ul>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {


    // Load agents list from backend via GET
    async function loadAgents(){
        try {
            const res = await fetch("{% url 'create-agent_api' %}", {
                method: "GET",
                headers: { "Accept": "application/json" }
            });
            if(res.ok){
                const agents = await res.json();
                const agentsList = document.getElementById('agentsList');
                agentsList.innerHTML = "";
                if(agents.length === 0){
                    agentsList.innerHTML = "<li class='list-group-item'>No agents created yet.</li>";
                } else {
                    agents.forEach(agent => {
                        const li = document.createElement('li');
                        li.className = "list-group-item";
                        li.textContent = `${agent.name} (${agent.email}) - ${agent.job_title}`;
                        agentsList.appendChild(li);
                    });
                }
            }
        } catch(err){
            console.error("Error loading agents:", err);
        }
    }

    // Initial load
    loadAgents();
});
</script>
{% endblock %}